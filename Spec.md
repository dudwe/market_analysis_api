# Project: Market Data Analysis API

**Initial Version (Using finmarketpy and FastAPI)**

### 1. Core Functionality

+ Fetch Market Data: Retrieve historical market data for specified stock tickers using finmarketpy.
+ Basic Analysis: Calculate:
    + Daily returns
    + Moving averages (e.g., 7-day, 30-day)
    + Volatility over a user-defined time period
+ Endpoints:
    + GET /market-data/{ticker}: Retrieve data for a single ticker with options for:
        + start_date and end_date (default to the last month if not specified)
        + metrics (e.g., daily returns, volatility)
        + Response: JSON structure including ticker, date range, average return, volatility, and any additional metrics requested.

### 2. FastAPI Server Requirements

+ Environment: Python (FastAPI, finmarketpy, uvicorn for running the server)
+ Error Handling: Return appropriate HTTP status codes and error messages for:
    + Invalid ticker symbols
    + Invalid or missing date parameters
    + Data unavailability for requested dates
+ Configuration:
    + Dockerize the FastAPI app (optional) for easier deployment.
+ Documentation:
    + Use OpenAPI docs (auto-generated by FastAPI) for endpoint documentation.

### 3. Data Storage (Optional for First Version)
+ Store fetched data temporarily in-memory to prevent repetitive API calls during a session.
+ Alternatively, use a lightweight database (e.g., SQLite) for storing recent requests.

## Additional Enhancements (Integrating Airflow)

### 1. Airflow DAG for Data Collection and Processing

+ Scheduled DAG: Run a daily DAG to:
    + Fetch data for a list of stock tickers (configurable in Airflow).
    + Process the data to compute daily returns, moving averages, and volatility.
    + Store processed data in a database (e.g., SQLite or PostgreSQL) for easy querying by FastAPI.
+ DAG Components:
    + Data Fetching Task: Retrieve data for each ticker.
    + Data Analysis Task: Perform basic analysis (daily returns, volatility, moving averages).
    + Data Storage Task: Store the computed metrics in a database with timestamped records.

### 2. Database Requirements for Airflow Integration
+ Use a relational database (e.g., SQLite, PostgreSQL) to store:
    + Raw market data (if needed)
    + Processed metrics with columns for ticker, date, daily_return, volatility, etc.
+ Ensure a structure that allows for easy filtering by ticker and date.

### 3. FastAPI Modifications for Airflow Integration
+ Modified Endpoints:
    + GET /market-data/{ticker}: Query the database for preprocessed data instead of making on-the-fly calculations.
    + GET /market-data/latest: Retrieve the latest data for a predefined list of tickers.
+ Response Caching (Optional): Implement caching in FastAPI for frequently requested data to optimize performance further.

### 4. Additional Trigger Endpoint for Airflow (Optional)
+ Create a POST /trigger-analysis/{ticker} endpoint in FastAPI:
    + This endpoint triggers an Airflow DAG to perform analysis on-demand for a specific ticker or date range, updating the database with fresh data.
### 5. Deployment Considerations
+ Environment Setup:
    + Configure Docker containers for both FastAPI and Airflow.
    + Use Docker Compose to manage the services.
+ Security:
    + Secure API endpoints (especially if exposing externally).
    + Use environment variables to store sensitive configurations (e.g., API keys for any market data provider).
### 6. Testing and Validation
+ Unit and Integration Tests: Validate FastAPI endpoints, data fetches, and analysis calculations.
+ Data Validation: Ensure data fetched is consistent and properly processed (e.g., missing values are handled).